3
Value
  (rec, @coq_rec,
    [
      ((f_map, [ A; B ], [ (f, (A -> B)); (l, Type (list, A)) ], Type (list, B)),
        Match
          ((4, Effect ([ ], .)), Variable ((4, Effect ([ ], .)), l),
            [
              (Constructor ([]), Constructor ((5, Effect ([ ], .)), []));
              (Constructor (cons, x, l),
                Constructor
                  ((6, Effect ([ ], .)),
                    cons,
                    Apply
                      ((6,
                        Effect
                          ([
                          ],
                            .)),
                        Variable
                          ((6,
                            Effect
                              ([
                              ],
                                .
                                  ->
                                  .)),
                            f),
                        [
                          Variable
                            ((6,
                              Effect
                                ([
                                ],
                                  .)),
                              x)
                        ]),
                    Apply
                      ((6,
                        Effect
                          ([
                          ],
                            .)),
                        Variable
                          ((6,
                            Effect
                              ([
                              ],
                                .
                                  ->
                                  .
                                    ->
                                    .)),
                            f_map),
                        [
                          Variable
                            ((6,
                              Effect
                                ([
                                ],
                                  .
                                    ->
                                    .)),
                              f);
                          Variable
                            ((6,
                              Effect
                                ([
                                ],
                                  .)),
                              l)
                        ])))
            ]))
    ])

9
Value
  (rec, @free_rec,
    [
      ((f_map2_rec, [ A; B ],
        [ (counter, Type (nat)); (f, (A -> B)); (l, Type (list, A)) ],
        Monad ([ Type (NonTermination) ], Type (list, B))),
        Match
          ((?, Effect ([ Type (NonTermination) ], .)),
            Variable ((?, Effect ([ ], .)), counter),
            [
              (Constructor (O),
                Apply
                  ((?,
                    Effect
                      ([
                        Type
                          (NonTermination)
                      ],
                        .)),
                    Variable
                      ((?,
                        Effect
                          ([
                          ],
                            .
                              -[
                                Type
                                  (NonTermination)
                              ]->
                              .)),
                        not_terminated),
                    [
                      Tuple
                        ((?,
                          Effect
                            ([
                            ],
                              .)))
                    ]));
              (Constructor (S, counter),
                Match
                  ((10,
                    Effect
                      ([
                        Type
                          (NonTermination)
                      ],
                        .)),
                    Variable
                      ((10,
                        Effect
                          ([
                          ],
                            .)),
                        l),
                    [
                      (Constructor
                        ([]),
                        Constructor
                          ((11,
                            Effect
                              ([
                              ],
                                .)),
                            []));
                      (Constructor
                        (cons,
                          x,
                          l),
                        Constructor
                          ((12,
                            Effect
                              ([
                                Type
                                  (NonTermination)
                              ],
                                .)),
                            cons,
                            Apply
                              ((12,
                                Effect
                                  ([
                                  ],
                                    .)),
                                Variable
                                  ((12,
                                    Effect
                                      ([
                                      ],
                                        .
                                          ->
                                          .)),
                                    f),
                                [
                                  Variable
                                    ((12,
                                      Effect
                                        ([
                                        ],
                                          .)),
                                      x)
                                ]),
                            Apply
                              ((12,
                                Effect
                                  ([
                                    Type
                                      (NonTermination)
                                  ],
                                    .)),
                                Apply
                                  ((?,
                                    Effect
                                      ([
                                      ],
                                        .
                                          ->
                                          .
                                            -[
                                              Type
                                                (NonTermination)
                                            ]->
                                            .)),
                                    Variable
                                      ((?,
                                        Effect
                                          ([
                                          ],
                                            .
                                              ->
                                              .
                                                ->
                                                .
                                                  -[
                                                    Type
                                                      (NonTermination)
                                                  ]->
                                                  .)),
                                        f_map2_rec),
                                    [
                                      Variable
                                        ((?,
                                          Effect
                                            ([
                                            ],
                                              .)),
                                          counter)
                                    ]),
                                [
                                  Variable
                                    ((12,
                                      Effect
                                        ([
                                        ],
                                          .
                                            ->
                                            .)),
                                      f);
                                  Variable
                                    ((12,
                                      Effect
                                        ([
                                        ],
                                          .)),
                                      l)
                                ])))
                    ]))
            ]))
    ])

9
Value
  (non_rec, @.,
    [
      ((f_map2, [ A; B ], [ (f, (A -> B)); (l, Type (list, A)) ],
        Monad ([ Type (Counter); Type (NonTermination) ], Type (list, B))),
        Apply
          ((?, Effect ([ Type (Counter); Type (NonTermination) ], .)),
            Variable
              ((?,
                Effect
                  ([ ], . -> . -> . -[ Type (NonTermination) ]-> .)),
                f_map2_rec),
            [
              Apply
                ((?, Effect ([ Type (Counter) ], .)),
                  Variable
                    ((?,
                      Effect
                        ([
                        ],
                          .
                            -[
                              Type
                                (Counter)
                            ]->
                            .)),
                      read_counter),
                  [
                    Tuple
                      ((?,
                        Effect
                          ([
                          ],
                            .)))
                  ]);
              Variable ((?, Effect ([ ], . -> .)), f);
              Variable ((?, Effect ([ ], .)), l)
            ]))
    ])

15
Value
  (non_rec, @.,
    [
      ((n, [ ], [ ], Type (Z)),
        LetFun (16, Effect ([ ], .))
          (rec, @coq_rec,
            [
              ((sum_coq_rec, [ ], [ (l, Type (list, Type (Z))) ],
                Type (Z)),
                Match
                  ((17, Effect ([ ], .)),
                    Variable
                      ((17,
                        Effect
                          ([
                          ],
                            .)),
                        l),
                    [
                      (Constructor
                        ([]),
                        Constant
                          ((18,
                            Effect
                              ([
                              ],
                                .)),
                            Int(0)));
                      (Constructor
                        (cons,
                          x,
                          l),
                        Apply
                          ((19,
                            Effect
                              ([
                              ],
                                .)),
                            Variable
                              ((19,
                                Effect
                                  ([
                                  ],
                                    .
                                      ->
                                      .
                                        ->
                                        .)),
                                Z.add),
                            [
                              Variable
                                ((19,
                                  Effect
                                    ([
                                    ],
                                      .)),
                                  x);
                              Apply
                                ((19,
                                  Effect
                                    ([
                                    ],
                                      .)),
                                  Variable
                                    ((19,
                                      Effect
                                        ([
                                        ],
                                          .
                                            ->
                                            .)),
                                      sum_coq_rec),
                                  [
                                    Variable
                                      ((19,
                                        Effect
                                          ([
                                          ],
                                            .)),
                                        l)
                                  ])
                            ]))
                    ]))
            ]) in
        Apply
          ((20, Effect ([ ], .)),
            Variable ((20, Effect ([ ], . -> .)), sum_coq_rec),
            [
              Constructor
                ((20, Effect ([ ], .)), cons,
                  Constant
                    ((20,
                      Effect
                        ([
                        ],
                          .)),
                      Int(1)),
                  Constructor
                    ((20,
                      Effect
                        ([
                        ],
                          .)),
                      cons,
                      Constant
                        ((20,
                          Effect
                            ([
                            ],
                              .)),
                          Int(2)),
                      Constructor
                        ((20,
                          Effect
                            ([
                            ],
                              .)),
                          cons,
                          Constant
                            ((20,
                              Effect
                                ([
                                ],
                                  .)),
                              Int(3)),
                          Constructor
                            ((20,
                              Effect
                                ([
                                ],
                                  .)),
                              []))))
            ]))
    ])

22
Value
  (non_rec, @.,
    [
      ((n2, [ A ], [ (x, A) ],
        Monad ([ Type (Counter); Type (NonTermination) ], Type (Z))),
        Match
          ((22, Effect ([ Type (Counter); Type (NonTermination) ], .)),
            Variable ((?, Effect ([ ], .)), x),
            [
              (Any,
                LetFun
                  (23,
                    Effect
                      ([
                        Type
                          (Counter);
                        Type
                          (NonTermination)
                      ],
                        .))
                  (rec, @.,
                    [
                      ((sum_rec,
                        [
                        ],
                        [
                          (counter,
                            Type
                              (nat));
                          (l,
                            Type
                              (list,
                                Type
                                  (Z)))
                        ],
                        Monad
                          ([
                            Type
                              (NonTermination)
                          ],
                            Type
                              (Z))),
                        Match
                          ((?,
                            Effect
                              ([
                                Type
                                  (NonTermination)
                              ],
                                .)),
                            Variable
                              ((?,
                                Effect
                                  ([
                                  ],
                                    .)),
                                counter),
                            [
                              (Constructor
                                (O),
                                Apply
                                  ((?,
                                    Effect
                                      ([
                                        Type
                                          (NonTermination)
                                      ],
                                        .)),
                                    Variable
                                      ((?,
                                        Effect
                                          ([
                                          ],
                                            .
                                              -[
                                                Type
                                                  (NonTermination)
                                              ]->
                                              .)),
                                        not_terminated),
                                    [
                                      Tuple
                                        ((?,
                                          Effect
                                            ([
                                            ],
                                              .)))
                                    ]));
                              (Constructor
                                (S,
                                  counter),
                                Match
                                  ((24,
                                    Effect
                                      ([
                                        Type
                                          (NonTermination)
                                      ],
                                        .)),
                                    Variable
                                      ((24,
                                        Effect
                                          ([
                                          ],
                                            .)),
                                        l),
                                    [
                                      (Constructor
                                        ([]),
                                        Constant
                                          ((25,
                                            Effect
                                              ([
                                              ],
                                                .)),
                                            Int(0)));
                                      (Constructor
                                        (cons,
                                          x,
                                          l),
                                        Apply
                                          ((26,
                                            Effect
                                              ([
                                                Type
                                                  (NonTermination)
                                              ],
                                                .)),
                                            Variable
                                              ((26,
                                                Effect
                                                  ([
                                                  ],
                                                    .
                                                      ->
                                                      .
                                                        ->
                                                        .)),
                                                Z.add),
                                            [
                                              Variable
                                                ((26,
                                                  Effect
                                                    ([
                                                    ],
                                                      .)),
                                                  x);
                                              Apply
                                                ((26,
                                                  Effect
                                                    ([
                                                      Type
                                                        (NonTermination)
                                                    ],
                                                      .)),
                                                  Apply
                                                    ((?,
                                                      Effect
                                                        ([
                                                        ],
                                                          .
                                                            -[
                                                              Type
                                                                (NonTermination)
                                                            ]->
                                                            .)),
                                                      Variable
                                                        ((?,
                                                          Effect
                                                            ([
                                                            ],
                                                              .
                                                                ->
                                                                .
                                                                  -[
                                                                    Type
                                                                      (NonTermination)
                                                                  ]->
                                                                  .)),
                                                          sum_rec),
                                                      [
                                                        Variable
                                                          ((?,
                                                            Effect
                                                              ([
                                                              ],
                                                                .)),
                                                            counter)
                                                      ]),
                                                  [
                                                    Variable
                                                      ((26,
                                                        Effect
                                                          ([
                                                          ],
                                                            .)),
                                                        l)
                                                  ])
                                            ]))
                                    ]))
                            ]))
                    ])
                  in
                LetFun
                  (23,
                    Effect
                      ([
                        Type
                          (Counter);
                        Type
                          (NonTermination)
                      ],
                        .))
                  (non_rec, @.,
                    [
                      ((sum
                      (=
                      sum_1),
                        [
                        ],
                        [
                          (l,
                            Type
                              (list,
                                Type
                                  (Z)))
                        ],
                        Monad
                          ([
                            Type
                              (Counter);
                            Type
                              (NonTermination)
                          ],
                            Type
                              (Z))),
                        Apply
                          ((?,
                            Effect
                              ([
                                Type
                                  (Counter);
                                Type
                                  (NonTermination)
                              ],
                                .)),
                            Variable
                              ((?,
                                Effect
                                  ([
                                  ],
                                    .
                                      ->
                                      .
                                        -[
                                          Type
                                            (NonTermination)
                                        ]->
                                        .)),
                                sum_rec),
                            [
                              Apply
                                ((?,
                                  Effect
                                    ([
                                      Type
                                        (Counter)
                                    ],
                                      .)),
                                  Variable
                                    ((?,
                                      Effect
                                        ([
                                        ],
                                          .
                                            -[
                                              Type
                                                (Counter)
                                            ]->
                                            .)),
                                      read_counter),
                                  [
                                    Tuple
                                      ((?,
                                        Effect
                                          ([
                                          ],
                                            .)))
                                  ]);
                              Variable
                                ((?,
                                  Effect
                                    ([
                                    ],
                                      .)),
                                  l)
                            ]))
                    ])
                  in
                Apply
                  ((27,
                    Effect
                      ([
                        Type
                          (Counter);
                        Type
                          (NonTermination)
                      ],
                        .)),
                    Variable
                      ((27,
                        Effect
                          ([
                          ],
                            .
                              -[
                                Type
                                  (Counter);
                                Type
                                  (NonTermination)
                              ]->
                              .)),
                        sum_1),
                    [
                      Constructor
                        ((27,
                          Effect
                            ([
                            ],
                              .)),
                          cons,
                          Constant
                            ((27,
                              Effect
                                ([
                                ],
                                  .)),
                              Int(1)),
                          Constructor
                            ((27,
                              Effect
                                ([
                                ],
                                  .)),
                              cons,
                              Constant
                                ((27,
                                  Effect
                                    ([
                                    ],
                                      .)),
                                  Int(2)),
                              Constructor
                                ((27,
                                  Effect
                                    ([
                                    ],
                                      .)),
                                  cons,
                                  Constant
                                    ((27,
                                      Effect
                                        ([
                                        ],
                                          .)),
                                      Int(3)),
                                  Constructor
                                    ((27,
                                      Effect
                                        ([
                                        ],
                                          .)),
                                      []))))
                    ]))
            ]))
    ])
