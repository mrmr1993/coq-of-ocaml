Require [ OCaml.List ]

2
Value
  (non_rec, @.,
    [
      ((slow_div, [ ], [ (a, Type (Z)); (b, Type (Z)) ],
        Monad
          ([ (OCaml.Effect.State.state, Z); Counter; NonTermination ],
            Type (Z))),
        Bind
          (?,
            Lift
              (?, [ (OCaml.Effect.State.state, Z) ],
                [
                  (OCaml.Effect.State.state, Z);
                  Counter;
                  NonTermination
                ],
                Apply
                  (3, Variable (3, OCaml.Pervasives.ref),
                    [ Constant (3, Int(0)) ])), Some y,
            Bind
              (?,
                Lift
                  (?, [ (OCaml.Effect.State.state, Z) ],
                    [
                      (OCaml.Effect.State.state, Z);
                      Counter;
                      NonTermination
                    ],
                    Apply
                      (4, Variable (4, OCaml.Pervasives.ref),
                        [ Constant (4, Int(0)) ])), Some c,
                Bind
                  (?,
                    LetFun 5
                      (rec, @.,
                        [
                          ((while, [ ],
                            [
                              (counter,
                                Type
                                  (nat))
                            ],
                            Monad
                              ([
                                (OCaml.Effect.State.state,
                                  Z);
                                NonTermination
                              ],
                                ())),
                            Match
                              (?,
                                Variable
                                  (?,
                                    counter),
                                [
                                  (Constructor
                                    (O),
                                    Lift
                                      (?,
                                        [
                                          NonTermination
                                        ],
                                        [
                                          (OCaml.Effect.State.state,
                                            Z);
                                          NonTermination
                                        ],
                                        Apply
                                          (?,
                                            Variable
                                              (?,
                                                not_terminated),
                                            [
                                              Constructor
                                                (?,
                                                  tt)
                                            ])));
                                  (Constructor
                                    (S,
                                      counter),
                                    Bind
                                      (?,
                                        Lift
                                          (?,
                                            [
                                              (OCaml.Effect.State.state,
                                                Z)
                                            ],
                                            [
                                              (OCaml.Effect.State.state,
                                                Z);
                                              NonTermination
                                            ],
                                            Bind
                                              (?,
                                                Bind
                                                  (?,
                                                    Apply
                                                      (5,
                                                        Variable
                                                          (5,
                                                            OCaml.Effect.State.read),
                                                        [
                                                          Variable
                                                            (5,
                                                              y)
                                                        ]),
                                                    Some
                                                      x,
                                                    Return
                                                      (?,
                                                        Apply
                                                          (5,
                                                            Variable
                                                              (5,
                                                                Z.add),
                                                            [
                                                              Variable
                                                                (?,
                                                                  x);
                                                              Variable
                                                                (5,
                                                                  b)
                                                            ]))),
                                                Some
                                                  x,
                                                Return
                                                  (?,
                                                    Apply
                                                      (5,
                                                        Variable
                                                          (5,
                                                            OCaml.Pervasives.le),
                                                        [
                                                          Variable
                                                            (?,
                                                              x);
                                                          Variable
                                                            (5,
                                                              a)
                                                        ])))),
                                        Some
                                          check,
                                        IfThenElse
                                          (?,
                                            Variable
                                              (?,
                                                check),
                                            Bind
                                              (?,
                                                Lift
                                                  (?,
                                                    [
                                                      (OCaml.Effect.State.state,
                                                        Z)
                                                    ],
                                                    [
                                                      (OCaml.Effect.State.state,
                                                        Z);
                                                      NonTermination
                                                    ],
                                                    Bind
                                                      (?,
                                                        Bind
                                                          (?,
                                                            Bind
                                                              (?,
                                                                Apply
                                                                  (6,
                                                                    Variable
                                                                      (6,
                                                                        OCaml.Effect.State.read),
                                                                    [
                                                                      Variable
                                                                        (6,
                                                                          y)
                                                                    ]),
                                                                Some
                                                                  x,
                                                                Return
                                                                  (?,
                                                                    Apply
                                                                      (6,
                                                                        Variable
                                                                          (6,
                                                                            Z.add),
                                                                        [
                                                                          Variable
                                                                            (?,
                                                                              x);
                                                                          Variable
                                                                            (6,
                                                                              b)
                                                                        ]))),
                                                            Some
                                                              x,
                                                            Apply
                                                              (6,
                                                                Variable
                                                                  (6,
                                                                    OCaml.Effect.State.write),
                                                                [
                                                                  Variable
                                                                    (6,
                                                                      y);
                                                                  Variable
                                                                    (?,
                                                                      x)
                                                                ])),
                                                        None,
                                                        Bind
                                                          (?,
                                                            Bind
                                                              (?,
                                                                Apply
                                                                  (7,
                                                                    Variable
                                                                      (7,
                                                                        OCaml.Effect.State.read),
                                                                    [
                                                                      Variable
                                                                        (7,
                                                                          c)
                                                                    ]),
                                                                Some
                                                                  x,
                                                                Return
                                                                  (?,
                                                                    Apply
                                                                      (7,
                                                                        Variable
                                                                          (7,
                                                                            Z.add),
                                                                        [
                                                                          Variable
                                                                            (?,
                                                                              x);
                                                                          Constant
                                                                            (7,
                                                                              Int(1))
                                                                        ]))),
                                                            Some
                                                              x,
                                                            Apply
                                                              (7,
                                                                Variable
                                                                  (7,
                                                                    OCaml.Effect.State.write),
                                                                [
                                                                  Variable
                                                                    (7,
                                                                      c);
                                                                  Variable
                                                                    (?,
                                                                      x)
                                                                ])))),
                                                None,
                                                Apply
                                                  (?,
                                                    Variable
                                                      (?,
                                                        while),
                                                    [
                                                      Variable
                                                        (?,
                                                          counter)
                                                    ])),
                                            Return
                                              (?,
                                                Constructor
                                                  (?,
                                                    tt)))))
                                ]))
                        ]) in
                    Bind
                      (?,
                        Lift
                          (?, [ Counter ],
                            [
                              (OCaml.Effect.State.state,
                                Z);
                              Counter;
                              NonTermination
                            ],
                            Apply
                              (?,
                                Variable
                                  (?, read_counter),
                                [ Constructor (?, tt) ])),
                        Some counter,
                        Lift
                          (?,
                            [
                              (OCaml.Effect.State.state,
                                Z);
                              NonTermination
                            ],
                            [
                              (OCaml.Effect.State.state,
                                Z);
                              Counter;
                              NonTermination
                            ],
                            Apply
                              (?, Variable (?, while),
                                [
                                  Variable
                                    (?,
                                      counter)
                                ]))), None,
                    Lift
                      (?, [ (OCaml.Effect.State.state, Z) ],
                        [
                          (OCaml.Effect.State.state, Z);
                          Counter;
                          NonTermination
                        ],
                        Apply
                          (9,
                            Variable
                              (9,
                                OCaml.Effect.State.read),
                            [ Variable (9, c) ]))))))
    ])

11
Value
  (non_rec, @.,
    [
      ((nested, [ ], [ (es_in, list Effect.t); (x, Type (unit)) ],
        Monad
          ([
            (OCaml.Effect.State.state, (list, Z));
            (OCaml.Effect.State.state,
              (list, (OCaml.Effect.State.t, (list, Z))));
            Counter;
            NonTermination
          ], Type (list, Type (Z)))),
        Match
          (?, Variable (?, x),
            [
              (Constructor (tt),
                Bind
                  (?,
                    Lift
                      (?,
                        [
                          (OCaml.Effect.State.state,
                            (list,
                              Z));
                          (OCaml.Effect.State.state,
                            (list,
                              (OCaml.Effect.State.t,
                                (list,
                                  Z))))
                        ],
                        [
                          (OCaml.Effect.State.state,
                            (list,
                              Z));
                          (OCaml.Effect.State.state,
                            (list,
                              (OCaml.Effect.State.t,
                                (list,
                                  Z))));
                          Counter;
                          NonTermination
                        ],
                        Bind
                          (?,
                            Lift
                              (?,
                                [
                                  (OCaml.Effect.State.state,
                                    (list,
                                      Z))
                                ],
                                [
                                  (OCaml.Effect.State.state,
                                    (list,
                                      Z));
                                  (OCaml.Effect.State.state,
                                    (list,
                                      (OCaml.Effect.State.t,
                                        (list,
                                          Z))))
                                ],
                                Bind
                                  (?,
                                    Apply
                                      (12,
                                        Variable
                                          (12,
                                            OCaml.Pervasives.ref),
                                        [
                                          Constructor
                                            (12,
                                              cons,
                                              Constant
                                                (12,
                                                  Int(1)),
                                              Constructor
                                                (12,
                                                  cons,
                                                  Constant
                                                    (12,
                                                      Int(2)),
                                                  Constructor
                                                    (12,
                                                      [])))
                                        ]),
                                    Some
                                      x_1,
                                    Bind
                                      (?,
                                        Bind
                                          (?,
                                            Apply
                                              (12,
                                                Variable
                                                  (12,
                                                    OCaml.Pervasives.ref),
                                                [
                                                  Constructor
                                                    (12,
                                                      cons,
                                                      Constant
                                                        (12,
                                                          Int(3)),
                                                      Constructor
                                                        (12,
                                                          cons,
                                                          Constant
                                                            (12,
                                                              Int(4)),
                                                          Constructor
                                                            (12,
                                                              cons,
                                                              Constant
                                                                (12,
                                                                  Int(5)),
                                                              Constructor
                                                                (12,
                                                                  []))))
                                                ]),
                                            Some
                                              x_2,
                                            Bind
                                              (?,
                                                Bind
                                                  (?,
                                                    Apply
                                                      (12,
                                                        Variable
                                                          (12,
                                                            OCaml.Pervasives.ref),
                                                        [
                                                          Constructor
                                                            (12,
                                                              cons,
                                                              Constant
                                                                (12,
                                                                  Int(6)),
                                                              Constructor
                                                                (12,
                                                                  cons,
                                                                  Constant
                                                                    (12,
                                                                      Int(7)),
                                                                  Constructor
                                                                    (12,
                                                                      [])))
                                                        ]),
                                                    Some
                                                      x_3,
                                                    Return
                                                      (?,
                                                        Constructor
                                                          (12,
                                                            cons,
                                                            Variable
                                                              (?,
                                                                x_3),
                                                            Constructor
                                                              (12,
                                                                [])))),
                                                Some
                                                  x_3,
                                                Return
                                                  (?,
                                                    Constructor
                                                      (12,
                                                        cons,
                                                        Variable
                                                          (?,
                                                            x_2),
                                                        Variable
                                                          (?,
                                                            x_3))))),
                                        Some
                                          x_2,
                                        Return
                                          (?,
                                            Constructor
                                              (12,
                                                cons,
                                                Variable
                                                  (?,
                                                    x_1),
                                                Variable
                                                  (?,
                                                    x_2)))))),
                            Some
                              x_1,
                            Lift
                              (?,
                                [
                                  (OCaml.Effect.State.state,
                                    (list,
                                      (OCaml.Effect.State.t,
                                        (list,
                                          Z))))
                                ],
                                [
                                  (OCaml.Effect.State.state,
                                    (list,
                                      Z));
                                  (OCaml.Effect.State.state,
                                    (list,
                                      (OCaml.Effect.State.t,
                                        (list,
                                          Z))))
                                ],
                                Apply
                                  (12,
                                    Variable
                                      (12,
                                        OCaml.Pervasives.ref),
                                    [
                                      Variable
                                        (?,
                                          x_1)
                                    ])))),
                    Some
                      a,
                    Bind
                      (?,
                        Lift
                          (?,
                            [
                              (OCaml.Effect.State.state,
                                (list,
                                  Z))
                            ],
                            [
                              (OCaml.Effect.State.state,
                                (list,
                                  Z));
                              (OCaml.Effect.State.state,
                                (list,
                                  (OCaml.Effect.State.t,
                                    (list,
                                      Z))));
                              Counter;
                              NonTermination
                            ],
                            Apply
                              (13,
                                Variable
                                  (13,
                                    OCaml.Pervasives.ref),
                                [
                                  Constructor
                                    (13,
                                      [])
                                ])),
                        Some
                          b,
                        Bind
                          (?,
                            LetFun
                              14
                              (rec,
                                @.,
                                [
                                  ((while,
                                    [
                                    ],
                                    [
                                      (counter,
                                        Type
                                          (nat))
                                    ],
                                    Monad
                                      ([
                                        (OCaml.Effect.State.state,
                                          (list,
                                            Z));
                                        (OCaml.Effect.State.state,
                                          (list,
                                            (OCaml.Effect.State.t,
                                              (list,
                                                Z))));
                                        Counter;
                                        NonTermination
                                      ],
                                        ())),
                                    Match
                                      (?,
                                        Variable
                                          (?,
                                            counter),
                                        [
                                          (Constructor
                                            (O),
                                            Lift
                                              (?,
                                                [
                                                  NonTermination
                                                ],
                                                [
                                                  (OCaml.Effect.State.state,
                                                    (list,
                                                      Z));
                                                  (OCaml.Effect.State.state,
                                                    (list,
                                                      (OCaml.Effect.State.t,
                                                        (list,
                                                          Z))));
                                                  Counter;
                                                  NonTermination
                                                ],
                                                Apply
                                                  (?,
                                                    Variable
                                                      (?,
                                                        not_terminated),
                                                    [
                                                      Constructor
                                                        (?,
                                                          tt)
                                                    ])));
                                          (Constructor
                                            (S,
                                              counter),
                                            Bind
                                              (?,
                                                Lift
                                                  (?,
                                                    [
                                                      (OCaml.Effect.State.state,
                                                        (list,
                                                          (OCaml.Effect.State.t,
                                                            (list,
                                                              Z))))
                                                    ],
                                                    [
                                                      (OCaml.Effect.State.state,
                                                        (list,
                                                          Z));
                                                      (OCaml.Effect.State.state,
                                                        (list,
                                                          (OCaml.Effect.State.t,
                                                            (list,
                                                              Z))));
                                                      Counter;
                                                      NonTermination
                                                    ],
                                                    Bind
                                                      (?,
                                                        Bind
                                                          (?,
                                                            Apply
                                                              (14,
                                                                Variable
                                                                  (14,
                                                                    OCaml.Effect.State.read),
                                                                [
                                                                  Variable
                                                                    (14,
                                                                      a)
                                                                ]),
                                                            Some
                                                              x_1,
                                                            Return
                                                              (?,
                                                                Apply
                                                                  (14,
                                                                    Variable
                                                                      (14,
                                                                        OCaml.List.length),
                                                                    [
                                                                      Variable
                                                                        (?,
                                                                          x_1)
                                                                    ]))),
                                                        Some
                                                          x_1,
                                                        Return
                                                          (?,
                                                            Apply
                                                              (14,
                                                                Variable
                                                                  (14,
                                                                    OCaml.Pervasives.gt),
                                                                [
                                                                  Variable
                                                                    (?,
                                                                      x_1);
                                                                  Constant
                                                                    (14,
                                                                      Int(0))
                                                                ])))),
                                                Some
                                                  check,
                                                IfThenElse
                                                  (?,
                                                    Variable
                                                      (?,
                                                        check),
                                                    Bind
                                                      (?,
                                                        Bind
                                                          (?,
                                                            Lift
                                                              (?,
                                                                [
                                                                  (OCaml.Effect.State.state,
                                                                    (list,
                                                                      (OCaml.Effect.State.t,
                                                                        (list,
                                                                          Z))))
                                                                ],
                                                                [
                                                                  (OCaml.Effect.State.state,
                                                                    (list,
                                                                      Z));
                                                                  (OCaml.Effect.State.state,
                                                                    (list,
                                                                      (OCaml.Effect.State.t,
                                                                        (list,
                                                                          Z))));
                                                                  Counter;
                                                                  NonTermination
                                                                ],
                                                                Apply
                                                                  (15,
                                                                    Variable
                                                                      (15,
                                                                        OCaml.Effect.State.read),
                                                                    [
                                                                      Variable
                                                                        (15,
                                                                          a)
                                                                    ])),
                                                            Some
                                                              x_1,
                                                            Match
                                                              (15,
                                                                Variable
                                                                  (?,
                                                                    x_1),
                                                                [
                                                                  (Constructor
                                                                    ([]),
                                                                    Return
                                                                      (?,
                                                                        Constructor
                                                                          (16,
                                                                            tt)));
                                                                  (Constructor
                                                                    (cons,
                                                                      x,
                                                                      a'),
                                                                    Bind
                                                                      (?,
                                                                        Lift
                                                                          (?,
                                                                            [
                                                                              (OCaml.Effect.State.state,
                                                                                (list,
                                                                                  Z));
                                                                              Counter;
                                                                              NonTermination
                                                                            ],
                                                                            [
                                                                              (OCaml.Effect.State.state,
                                                                                (list,
                                                                                  Z));
                                                                              (OCaml.Effect.State.state,
                                                                                (list,
                                                                                  (OCaml.Effect.State.t,
                                                                                    (list,
                                                                                      Z))));
                                                                              Counter;
                                                                              NonTermination
                                                                            ],
                                                                            LetFun
                                                                              18
                                                                              (rec,
                                                                                @.,
                                                                                [
                                                                                  ((while_1,
                                                                                    [
                                                                                    ],
                                                                                    [
                                                                                      (counter_1,
                                                                                        Type
                                                                                          (nat))
                                                                                    ],
                                                                                    Monad
                                                                                      ([
                                                                                        (OCaml.Effect.State.state,
                                                                                          (list,
                                                                                            Z));
                                                                                        NonTermination
                                                                                      ],
                                                                                        ())),
                                                                                    Match
                                                                                      (?,
                                                                                        Variable
                                                                                          (?,
                                                                                            counter_1),
                                                                                        [
                                                                                          (Constructor
                                                                                            (O),
                                                                                            Lift
                                                                                              (?,
                                                                                                [
                                                                                                  NonTermination
                                                                                                ],
                                                                                                [
                                                                                                  (OCaml.Effect.State.state,
                                                                                                    (list,
                                                                                                      Z));
                                                                                                  NonTermination
                                                                                                ],
                                                                                                Apply
                                                                                                  (?,
                                                                                                    Variable
                                                                                                      (?,
                                                                                                        not_terminated),
                                                                                                    [
                                                                                                      Constructor
                                                                                                        (?,
                                                                                                          tt)
                                                                                                    ])));
                                                                                          (Constructor
                                                                                            (S,
                                                                                              counter_1),
                                                                                            Bind
                                                                                              (?,
                                                                                                Lift
                                                                                                  (?,
                                                                                                    [
                                                                                                      (OCaml.Effect.State.state,
                                                                                                        (list,
                                                                                                          Z))
                                                                                                    ],
                                                                                                    [
                                                                                                      (OCaml.Effect.State.state,
                                                                                                        (list,
                                                                                                          Z));
                                                                                                      NonTermination
                                                                                                    ],
                                                                                                    Bind
                                                                                                      (?,
                                                                                                        Bind
                                                                                                          (?,
                                                                                                            Apply
                                                                                                              (18,
                                                                                                                Variable
                                                                                                                  (18,
                                                                                                                    OCaml.Effect.State.read),
                                                                                                                [
                                                                                                                  Variable
                                                                                                                    (18,
                                                                                                                      x)
                                                                                                                ]),
                                                                                                            Some
                                                                                                              x_1,
                                                                                                            Return
                                                                                                              (?,
                                                                                                                Apply
                                                                                                                  (18,
                                                                                                                    Variable
                                                                                                                      (18,
                                                                                                                        OCaml.List.length),
                                                                                                                    [
                                                                                                                      Variable
                                                                                                                        (?,
                                                                                                                          x_1)
                                                                                                                    ]))),
                                                                                                        Some
                                                                                                          x_1,
                                                                                                        Return
                                                                                                          (?,
                                                                                                            Apply
                                                                                                              (18,
                                                                                                                Variable
                                                                                                                  (18,
                                                                                                                    OCaml.Pervasives.gt),
                                                                                                                [
                                                                                                                  Variable
                                                                                                                    (?,
                                                                                                                      x_1);
                                                                                                                  Constant
                                                                                                                    (18,
                                                                                                                      Int(0))
                                                                                                                ])))),
                                                                                                Some
                                                                                                  check_1,
                                                                                                IfThenElse
                                                                                                  (?,
                                                                                                    Variable
                                                                                                      (?,
                                                                                                        check_1),
                                                                                                    Bind
                                                                                                      (?,
                                                                                                        Lift
                                                                                                          (?,
                                                                                                            [
                                                                                                              (OCaml.Effect.State.state,
                                                                                                                (list,
                                                                                                                  Z))
                                                                                                            ],
                                                                                                            [
                                                                                                              (OCaml.Effect.State.state,
                                                                                                                (list,
                                                                                                                  Z));
                                                                                                              NonTermination
                                                                                                            ],
                                                                                                            Bind
                                                                                                              (?,
                                                                                                                Apply
                                                                                                                  (19,
                                                                                                                    Variable
                                                                                                                      (19,
                                                                                                                        OCaml.Effect.State.read),
                                                                                                                    [
                                                                                                                      Variable
                                                                                                                        (19,
                                                                                                                          x)
                                                                                                                    ]),
                                                                                                                Some
                                                                                                                  x_1,
                                                                                                                Match
                                                                                                                  (19,
                                                                                                                    Variable
                                                                                                                      (?,
                                                                                                                        x_1),
                                                                                                                    [
                                                                                                                      (Constructor
                                                                                                                        ([]),
                                                                                                                        Return
                                                                                                                          (?,
                                                                                                                            Constructor
                                                                                                                              (20,
                                                                                                                                tt)));
                                                                                                                      (Constructor
                                                                                                                        (cons,
                                                                                                                          y,
                                                                                                                          x'),
                                                                                                                        Bind
                                                                                                                          (?,
                                                                                                                            Bind
                                                                                                                              (?,
                                                                                                                                Bind
                                                                                                                                  (?,
                                                                                                                                    Apply
                                                                                                                                      (22,
                                                                                                                                        Variable
                                                                                                                                          (22,
                                                                                                                                            OCaml.Effect.State.read),
                                                                                                                                        [
                                                                                                                                          Variable
                                                                                                                                            (22,
                                                                                                                                              b)
                                                                                                                                        ]),
                                                                                                                                    Some
                                                                                                                                      x_1,
                                                                                                                                    Return
                                                                                                                                      (?,
                                                                                                                                        Constructor
                                                                                                                                          (22,
                                                                                                                                            cons,
                                                                                                                                            Variable
                                                                                                                                              (22,
                                                                                                                                                y),
                                                                                                                                            Variable
                                                                                                                                              (?,
                                                                                                                                                x_1)))),
                                                                                                                                Some
                                                                                                                                  x_1,
                                                                                                                                Apply
                                                                                                                                  (22,
                                                                                                                                    Variable
                                                                                                                                      (22,
                                                                                                                                        OCaml.Effect.State.write),
                                                                                                                                    [
                                                                                                                                      Variable
                                                                                                                                        (22,
                                                                                                                                          b);
                                                                                                                                      Variable
                                                                                                                                        (?,
                                                                                                                                          x_1)
                                                                                                                                    ])),
                                                                                                                            None,
                                                                                                                            Apply
                                                                                                                              (23,
                                                                                                                                Variable
                                                                                                                                  (23,
                                                                                                                                    OCaml.Effect.State.write),
                                                                                                                                [
                                                                                                                                  Variable
                                                                                                                                    (23,
                                                                                                                                      x);
                                                                                                                                  Variable
                                                                                                                                    (23,
                                                                                                                                      x')
                                                                                                                                ])))
                                                                                                                    ]))),
                                                                                                        None,
                                                                                                        Apply
                                                                                                          (?,
                                                                                                            Variable
                                                                                                              (?,
                                                                                                                while_1),
                                                                                                            [
                                                                                                              Variable
                                                                                                                (?,
                                                                                                                  counter_1)
                                                                                                            ])),
                                                                                                    Return
                                                                                                      (?,
                                                                                                        Constructor
                                                                                                          (?,
                                                                                                            tt)))))
                                                                                        ]))
                                                                                ])
                                                                              in
                                                                            Bind
                                                                              (?,
                                                                                Lift
                                                                                  (?,
                                                                                    [
                                                                                      Counter
                                                                                    ],
                                                                                    [
                                                                                      (OCaml.Effect.State.state,
                                                                                        (list,
                                                                                          Z));
                                                                                      Counter;
                                                                                      NonTermination
                                                                                    ],
                                                                                    Apply
                                                                                      (?,
                                                                                        Variable
                                                                                          (?,
                                                                                            read_counter),
                                                                                        [
                                                                                          Constructor
                                                                                            (?,
                                                                                              tt)
                                                                                        ])),
                                                                                Some
                                                                                  counter_1,
                                                                                Lift
                                                                                  (?,
                                                                                    [
                                                                                      (OCaml.Effect.State.state,
                                                                                        (list,
                                                                                          Z));
                                                                                      NonTermination
                                                                                    ],
                                                                                    [
                                                                                      (OCaml.Effect.State.state,
                                                                                        (list,
                                                                                          Z));
                                                                                      Counter;
                                                                                      NonTermination
                                                                                    ],
                                                                                    Apply
                                                                                      (?,
                                                                                        Variable
                                                                                          (?,
                                                                                            while_1),
                                                                                        [
                                                                                          Variable
                                                                                            (?,
                                                                                              counter_1)
                                                                                        ])))),
                                                                        None,
                                                                        Lift
                                                                          (?,
                                                                            [
                                                                              (OCaml.Effect.State.state,
                                                                                (list,
                                                                                  (OCaml.Effect.State.t,
                                                                                    (list,
                                                                                      Z))))
                                                                            ],
                                                                            [
                                                                              (OCaml.Effect.State.state,
                                                                                (list,
                                                                                  Z));
                                                                              (OCaml.Effect.State.state,
                                                                                (list,
                                                                                  (OCaml.Effect.State.t,
                                                                                    (list,
                                                                                      Z))));
                                                                              Counter;
                                                                              NonTermination
                                                                            ],
                                                                            Apply
                                                                              (25,
                                                                                Variable
                                                                                  (25,
                                                                                    OCaml.Effect.State.write),
                                                                                [
                                                                                  Variable
                                                                                    (25,
                                                                                      a);
                                                                                  Variable
                                                                                    (25,
                                                                                      a')
                                                                                ]))))
                                                                ])),
                                                        None,
                                                        Apply
                                                          (?,
                                                            Variable
                                                              (?,
                                                                while),
                                                            [
                                                              Variable
                                                                (?,
                                                                  counter)
                                                            ])),
                                                    Return
                                                      (?,
                                                        Constructor
                                                          (?,
                                                            tt)))))
                                        ]))
                                ])
                              in
                            Bind
                              (?,
                                Lift
                                  (?,
                                    [
                                      Counter
                                    ],
                                    [
                                      (OCaml.Effect.State.state,
                                        (list,
                                          Z));
                                      (OCaml.Effect.State.state,
                                        (list,
                                          (OCaml.Effect.State.t,
                                            (list,
                                              Z))));
                                      Counter;
                                      NonTermination
                                    ],
                                    Apply
                                      (?,
                                        Variable
                                          (?,
                                            read_counter),
                                        [
                                          Constructor
                                            (?,
                                              tt)
                                        ])),
                                Some
                                  counter,
                                Apply
                                  (?,
                                    Variable
                                      (?,
                                        while),
                                    [
                                      Variable
                                        (?,
                                          counter)
                                    ])),
                            None,
                            Lift
                              (?,
                                [
                                  (OCaml.Effect.State.state,
                                    (list,
                                      Z))
                                ],
                                [
                                  (OCaml.Effect.State.state,
                                    (list,
                                      Z));
                                  (OCaml.Effect.State.state,
                                    (list,
                                      (OCaml.Effect.State.t,
                                        (list,
                                          Z))));
                                  Counter;
                                  NonTermination
                                ],
                                Apply
                                  (27,
                                    Variable
                                      (27,
                                        OCaml.Effect.State.read),
                                    [
                                      Variable
                                        (27,
                                          b)
                                    ]))))))
            ]))
    ])

29
Value
  (non_rec, @.,
    [
      ((raises, [ ], [ (b, Type (bool)) ],
        Monad ([ Counter; NonTermination; OCaml.Failure ], Type (unit))),
        LetFun 30
          (rec, @.,
            [
              ((while, [ ], [ (counter, Type (nat)) ],
                Monad
                  ([
                    NonTermination;
                    OCaml.Failure
                  ], ())),
                Match
                  (?,
                    Variable
                      (?,
                        counter),
                    [
                      (Constructor
                        (O),
                        Lift
                          (?,
                            [
                              NonTermination
                            ],
                            [
                              NonTermination;
                              OCaml.Failure
                            ],
                            Apply
                              (?,
                                Variable
                                  (?,
                                    not_terminated),
                                [
                                  Constructor
                                    (?,
                                      tt)
                                ])));
                      (Constructor
                        (S,
                          counter),
                        LetVar
                          ?
                          check
                          =
                          Variable
                            (30,
                              b)
                          in
                        IfThenElse
                          (?,
                            Variable
                              (?,
                                check),
                            Bind
                              (?,
                                Lift
                                  (?,
                                    [
                                      OCaml.Failure
                                    ],
                                    [
                                      NonTermination;
                                      OCaml.Failure
                                    ],
                                    Coerce
                                      (?,
                                        Apply
                                          (31,
                                            Variable
                                              (31,
                                                OCaml.Pervasives.failwith),
                                            [
                                              Constant
                                                (31,
                                                  String("b is true"))
                                            ]),
                                        Monad
                                          ([
                                            OCaml.Failure
                                          ],
                                            ()))),
                                None,
                                Apply
                                  (?,
                                    Variable
                                      (?,
                                        while),
                                    [
                                      Variable
                                        (?,
                                          counter)
                                    ])),
                            Return
                              (?,
                                Constructor
                                  (?,
                                    tt))))
                    ]))
            ]) in
        Bind
          (?,
            Lift
              (?, [ Counter ],
                [ Counter; NonTermination; OCaml.Failure ],
                Apply
                  (?, Variable (?, read_counter),
                    [ Constructor (?, tt) ])), Some counter,
            Lift
              (?, [ NonTermination; OCaml.Failure ],
                [ Counter; NonTermination; OCaml.Failure ],
                Apply
                  (?, Variable (?, while), [ Variable (?, counter) ]))))
    ])

34
Value
  (non_rec, @.,
    [
      ((argument_effects, [ ],
        [ (x, Type (OCaml.Effect.State.t, Type (Z))); (y, Type (Z)) ],
        Monad
          ([ (OCaml.Effect.State.state, Z); Counter; NonTermination ],
            Type (Z))),
        Bind
          (?,
            Lift
              (?, [ (OCaml.Effect.State.state, Z) ],
                [
                  (OCaml.Effect.State.state, Z);
                  Counter;
                  NonTermination
                ],
                Apply
                  (35, Variable (35, OCaml.Pervasives.ref),
                    [ Variable (35, y) ])), Some y,
            Bind
              (?,
                Lift
                  (?, [ (OCaml.Effect.State.state, Z) ],
                    [
                      (OCaml.Effect.State.state, Z);
                      Counter;
                      NonTermination
                    ],
                    Apply
                      (36, Variable (36, OCaml.Pervasives.ref),
                        [ Constant (36, Int(0)) ])), Some z,
                Bind
                  (?,
                    Lift
                      (?, [ (OCaml.Effect.State.state, Z) ],
                        [
                          (OCaml.Effect.State.state, Z);
                          Counter;
                          NonTermination
                        ],
                        Apply
                          (37,
                            Variable
                              (37, OCaml.Pervasives.ref),
                            [ Constant (37, Int(0)) ])),
                    Some i,
                    Bind
                      (?,
                        LetFun 38
                          (rec, @.,
                            [
                              ((while, [ ],
                                [
                                  (counter,
                                    Type
                                      (nat))
                                ],
                                Monad
                                  ([
                                    (OCaml.Effect.State.state,
                                      Z);
                                    Counter;
                                    NonTermination
                                  ],
                                    ())),
                                Match
                                  (?,
                                    Variable
                                      (?,
                                        counter),
                                    [
                                      (Constructor
                                        (O),
                                        Lift
                                          (?,
                                            [
                                              NonTermination
                                            ],
                                            [
                                              (OCaml.Effect.State.state,
                                                Z);
                                              Counter;
                                              NonTermination
                                            ],
                                            Apply
                                              (?,
                                                Variable
                                                  (?,
                                                    not_terminated),
                                                [
                                                  Constructor
                                                    (?,
                                                      tt)
                                                ])));
                                      (Constructor
                                        (S,
                                          counter),
                                        Bind
                                          (?,
                                            Lift
                                              (?,
                                                [
                                                  (OCaml.Effect.State.state,
                                                    Z)
                                                ],
                                                [
                                                  (OCaml.Effect.State.state,
                                                    Z);
                                                  Counter;
                                                  NonTermination
                                                ],
                                                Bind
                                                  (?,
                                                    Apply
                                                      (38,
                                                        Variable
                                                          (38,
                                                            OCaml.Effect.State.read),
                                                        [
                                                          Variable
                                                            (38,
                                                              i)
                                                        ]),
                                                    Some
                                                      x_1,
                                                    Bind
                                                      (?,
                                                        Apply
                                                          (38,
                                                            Variable
                                                              (38,
                                                                OCaml.Effect.State.read),
                                                            [
                                                              Variable
                                                                (38,
                                                                  x)
                                                            ]),
                                                        Some
                                                          x_2,
                                                        Return
                                                          (?,
                                                            Apply
                                                              (38,
                                                                Variable
                                                                  (38,
                                                                    OCaml.Pervasives.le),
                                                                [
                                                                  Variable
                                                                    (?,
                                                                      x_1);
                                                                  Variable
                                                                    (?,
                                                                      x_2)
                                                                ]))))),
                                            Some
                                              check,
                                            IfThenElse
                                              (?,
                                                Variable
                                                  (?,
                                                    check),
                                                Bind
                                                  (?,
                                                    Bind
                                                      (?,
                                                        Lift
                                                          (?,
                                                            [
                                                              (OCaml.Effect.State.state,
                                                                Z)
                                                            ],
                                                            [
                                                              (OCaml.Effect.State.state,
                                                                Z);
                                                              Counter;
                                                              NonTermination
                                                            ],
                                                            Apply
                                                              (39,
                                                                Variable
                                                                  (39,
                                                                    OCaml.Pervasives.ref),
                                                                [
                                                                  Constant
                                                                    (39,
                                                                      Int(0))
                                                                ])),
                                                        Some
                                                          j,
                                                        Bind
                                                          (?,
                                                            LetFun
                                                              40
                                                              (rec,
                                                                @.,
                                                                [
                                                                  ((while_1,
                                                                    [
                                                                    ],
                                                                    [
                                                                      (counter_1,
                                                                        Type
                                                                          (nat))
                                                                    ],
                                                                    Monad
                                                                      ([
                                                                        (OCaml.Effect.State.state,
                                                                          Z);
                                                                        NonTermination
                                                                      ],
                                                                        ())),
                                                                    Match
                                                                      (?,
                                                                        Variable
                                                                          (?,
                                                                            counter_1),
                                                                        [
                                                                          (Constructor
                                                                            (O),
                                                                            Lift
                                                                              (?,
                                                                                [
                                                                                  NonTermination
                                                                                ],
                                                                                [
                                                                                  (OCaml.Effect.State.state,
                                                                                    Z);
                                                                                  NonTermination
                                                                                ],
                                                                                Apply
                                                                                  (?,
                                                                                    Variable
                                                                                      (?,
                                                                                        not_terminated),
                                                                                    [
                                                                                      Constructor
                                                                                        (?,
                                                                                          tt)
                                                                                    ])));
                                                                          (Constructor
                                                                            (S,
                                                                              counter_1),
                                                                            Bind
                                                                              (?,
                                                                                Lift
                                                                                  (?,
                                                                                    [
                                                                                      (OCaml.Effect.State.state,
                                                                                        Z)
                                                                                    ],
                                                                                    [
                                                                                      (OCaml.Effect.State.state,
                                                                                        Z);
                                                                                      NonTermination
                                                                                    ],
                                                                                    Bind
                                                                                      (?,
                                                                                        Apply
                                                                                          (40,
                                                                                            Variable
                                                                                              (40,
                                                                                                OCaml.Effect.State.read),
                                                                                            [
                                                                                              Variable
                                                                                                (40,
                                                                                                  j)
                                                                                            ]),
                                                                                        Some
                                                                                          x_1,
                                                                                        Bind
                                                                                          (?,
                                                                                            Apply
                                                                                              (40,
                                                                                                Variable
                                                                                                  (40,
                                                                                                    OCaml.Effect.State.read),
                                                                                                [
                                                                                                  Variable
                                                                                                    (40,
                                                                                                      y)
                                                                                                ]),
                                                                                            Some
                                                                                              x_2,
                                                                                            Return
                                                                                              (?,
                                                                                                Apply
                                                                                                  (40,
                                                                                                    Variable
                                                                                                      (40,
                                                                                                        OCaml.Pervasives.le),
                                                                                                    [
                                                                                                      Variable
                                                                                                        (?,
                                                                                                          x_1);
                                                                                                      Variable
                                                                                                        (?,
                                                                                                          x_2)
                                                                                                    ]))))),
                                                                                Some
                                                                                  check_1,
                                                                                IfThenElse
                                                                                  (?,
                                                                                    Variable
                                                                                      (?,
                                                                                        check_1),
                                                                                    Bind
                                                                                      (?,
                                                                                        Lift
                                                                                          (?,
                                                                                            [
                                                                                              (OCaml.Effect.State.state,
                                                                                                Z)
                                                                                            ],
                                                                                            [
                                                                                              (OCaml.Effect.State.state,
                                                                                                Z);
                                                                                              NonTermination
                                                                                            ],
                                                                                            Bind
                                                                                              (?,
                                                                                                Bind
                                                                                                  (?,
                                                                                                    Bind
                                                                                                      (?,
                                                                                                        Apply
                                                                                                          (41,
                                                                                                            Variable
                                                                                                              (41,
                                                                                                                OCaml.Effect.State.read),
                                                                                                            [
                                                                                                              Variable
                                                                                                                (41,
                                                                                                                  z)
                                                                                                            ]),
                                                                                                        Some
                                                                                                          x_1,
                                                                                                        Return
                                                                                                          (?,
                                                                                                            Apply
                                                                                                              (41,
                                                                                                                Variable
                                                                                                                  (41,
                                                                                                                    Z.add),
                                                                                                                [
                                                                                                                  Variable
                                                                                                                    (?,
                                                                                                                      x_1);
                                                                                                                  Constant
                                                                                                                    (41,
                                                                                                                      Int(1))
                                                                                                                ]))),
                                                                                                    Some
                                                                                                      x_1,
                                                                                                    Apply
                                                                                                      (41,
                                                                                                        Variable
                                                                                                          (41,
                                                                                                            OCaml.Effect.State.write),
                                                                                                        [
                                                                                                          Variable
                                                                                                            (41,
                                                                                                              z);
                                                                                                          Variable
                                                                                                            (?,
                                                                                                              x_1)
                                                                                                        ])),
                                                                                                None,
                                                                                                Bind
                                                                                                  (?,
                                                                                                    Bind
                                                                                                      (?,
                                                                                                        Apply
                                                                                                          (42,
                                                                                                            Variable
                                                                                                              (42,
                                                                                                                OCaml.Effect.State.read),
                                                                                                            [
                                                                                                              Variable
                                                                                                                (42,
                                                                                                                  j)
                                                                                                            ]),
                                                                                                        Some
                                                                                                          x_1,
                                                                                                        Return
                                                                                                          (?,
                                                                                                            Apply
                                                                                                              (42,
                                                                                                                Variable
                                                                                                                  (42,
                                                                                                                    Z.add),
                                                                                                                [
                                                                                                                  Variable
                                                                                                                    (?,
                                                                                                                      x_1);
                                                                                                                  Constant
                                                                                                                    (42,
                                                                                                                      Int(1))
                                                                                                                ]))),
                                                                                                    Some
                                                                                                      x_1,
                                                                                                    Apply
                                                                                                      (42,
                                                                                                        Variable
                                                                                                          (42,
                                                                                                            OCaml.Effect.State.write),
                                                                                                        [
                                                                                                          Variable
                                                                                                            (42,
                                                                                                              j);
                                                                                                          Variable
                                                                                                            (?,
                                                                                                              x_1)
                                                                                                        ])))),
                                                                                        None,
                                                                                        Apply
                                                                                          (?,
                                                                                            Variable
                                                                                              (?,
                                                                                                while_1),
                                                                                            [
                                                                                              Variable
                                                                                                (?,
                                                                                                  counter_1)
                                                                                            ])),
                                                                                    Return
                                                                                      (?,
                                                                                        Constructor
                                                                                          (?,
                                                                                            tt)))))
                                                                        ]))
                                                                ])
                                                              in
                                                            Bind
                                                              (?,
                                                                Lift
                                                                  (?,
                                                                    [
                                                                      Counter
                                                                    ],
                                                                    [
                                                                      (OCaml.Effect.State.state,
                                                                        Z);
                                                                      Counter;
                                                                      NonTermination
                                                                    ],
                                                                    Apply
                                                                      (?,
                                                                        Variable
                                                                          (?,
                                                                            read_counter),
                                                                        [
                                                                          Constructor
                                                                            (?,
                                                                              tt)
                                                                        ])),
                                                                Some
                                                                  counter_1,
                                                                Lift
                                                                  (?,
                                                                    [
                                                                      (OCaml.Effect.State.state,
                                                                        Z);
                                                                      NonTermination
                                                                    ],
                                                                    [
                                                                      (OCaml.Effect.State.state,
                                                                        Z);
                                                                      Counter;
                                                                      NonTermination
                                                                    ],
                                                                    Apply
                                                                      (?,
                                                                        Variable
                                                                          (?,
                                                                            while_1),
                                                                        [
                                                                          Variable
                                                                            (?,
                                                                              counter_1)
                                                                        ]))),
                                                            None,
                                                            Lift
                                                              (?,
                                                                [
                                                                  (OCaml.Effect.State.state,
                                                                    Z)
                                                                ],
                                                                [
                                                                  (OCaml.Effect.State.state,
                                                                    Z);
                                                                  Counter;
                                                                  NonTermination
                                                                ],
                                                                Bind
                                                                  (?,
                                                                    Bind
                                                                      (?,
                                                                        Bind
                                                                          (?,
                                                                            Apply
                                                                              (44,
                                                                                Variable
                                                                                  (44,
                                                                                    OCaml.Effect.State.read),
                                                                                [
                                                                                  Variable
                                                                                    (44,
                                                                                      y)
                                                                                ]),
                                                                            Some
                                                                              x_1,
                                                                            Return
                                                                              (?,
                                                                                Apply
                                                                                  (44,
                                                                                    Variable
                                                                                      (44,
                                                                                        Z.sub),
                                                                                    [
                                                                                      Variable
                                                                                        (?,
                                                                                          x_1);
                                                                                      Constant
                                                                                        (44,
                                                                                          Int(1))
                                                                                    ]))),
                                                                        Some
                                                                          x_1,
                                                                        Apply
                                                                          (44,
                                                                            Variable
                                                                              (44,
                                                                                OCaml.Effect.State.write),
                                                                            [
                                                                              Variable
                                                                                (44,
                                                                                  y);
                                                                              Variable
                                                                                (?,
                                                                                  x_1)
                                                                            ])),
                                                                    None,
                                                                    Bind
                                                                      (?,
                                                                        Bind
                                                                          (?,
                                                                            Apply
                                                                              (45,
                                                                                Variable
                                                                                  (45,
                                                                                    OCaml.Effect.State.read),
                                                                                [
                                                                                  Variable
                                                                                    (45,
                                                                                      i)
                                                                                ]),
                                                                            Some
                                                                              x_1,
                                                                            Return
                                                                              (?,
                                                                                Apply
                                                                                  (45,
                                                                                    Variable
                                                                                      (45,
                                                                                        Z.add),
                                                                                    [
                                                                                      Variable
                                                                                        (?,
                                                                                          x_1);
                                                                                      Constant
                                                                                        (45,
                                                                                          Int(1))
                                                                                    ]))),
                                                                        Some
                                                                          x_1,
                                                                        Apply
                                                                          (45,
                                                                            Variable
                                                                              (45,
                                                                                OCaml.Effect.State.write),
                                                                            [
                                                                              Variable
                                                                                (45,
                                                                                  i);
                                                                              Variable
                                                                                (?,
                                                                                  x_1)
                                                                            ])))))),
                                                    None,
                                                    Apply
                                                      (?,
                                                        Variable
                                                          (?,
                                                            while),
                                                        [
                                                          Variable
                                                            (?,
                                                              counter)
                                                        ])),
                                                Return
                                                  (?,
                                                    Constructor
                                                      (?,
                                                        tt)))))
                                    ]))
                            ]) in
                        Bind
                          (?,
                            Lift
                              (?, [ Counter ],
                                [
                                  (OCaml.Effect.State.state,
                                    Z);
                                  Counter;
                                  NonTermination
                                ],
                                Apply
                                  (?,
                                    Variable
                                      (?,
                                        read_counter),
                                    [
                                      Constructor
                                        (?,
                                          tt)
                                    ])),
                            Some counter,
                            Apply
                              (?, Variable (?, while),
                                [
                                  Variable
                                    (?,
                                      counter)
                                ])), None,
                        Lift
                          (?,
                            [
                              (OCaml.Effect.State.state,
                                Z)
                            ],
                            [
                              (OCaml.Effect.State.state,
                                Z);
                              Counter;
                              NonTermination
                            ],
                            Apply
                              (47,
                                Variable
                                  (47,
                                    OCaml.Effect.State.read),
                                [ Variable (47, z) ])))))))
    ])
