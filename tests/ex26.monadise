3
Value
  (rec, @coq_rec,
    [
      ((f_map, [ A; B ], [ (f, (A -> B)); (l, Type (list, A)) ], Type (list, B)),
        Match
          (4, Variable (4, l),
            [
              (Constructor ([]), Constructor (5, []));
              (Constructor (cons, x, l),
                Constructor
                  (6, cons,
                    Apply
                      (6,
                        Variable
                          (6,
                            f),
                        [
                          Variable
                            (6,
                              x)
                        ]),
                    Apply
                      (6,
                        Variable
                          (6,
                            f_map),
                        [
                          Variable
                            (6,
                              f);
                          Variable
                            (6,
                              l)
                        ])))
            ]))
    ])

9
Value
  (rec, @free_rec,
    [
      ((f_map2_rec, [ A; B ],
        [ (counter, Type (nat)); (f, (A -> B)); (l, Type (list, A)) ],
        Monad ([ Type (NonTermination) ], Type (list, B))),
        Match
          (?, Variable (?, counter),
            [
              (Constructor (O),
                Apply
                  (?,
                    Variable
                      (?,
                        not_terminated),
                    [
                      Tuple
                        (?)
                    ]));
              (Constructor (S, counter),
                Match
                  (10, Variable (10, l),
                    [
                      (Constructor
                        ([]),
                        Return
                          (?,
                            Constructor
                              (11,
                                [])));
                      (Constructor
                        (cons,
                          x,
                          l),
                        Bind
                          (?,
                            Apply
                              (12,
                                Apply
                                  (?,
                                    Variable
                                      (?,
                                        f_map2_rec),
                                    [
                                      Variable
                                        (?,
                                          counter)
                                    ]),
                                [
                                  Variable
                                    (12,
                                      f);
                                  Variable
                                    (12,
                                      l)
                                ]),
                            Some
                              x_1,
                            Return
                              (?,
                                Constructor
                                  (12,
                                    cons,
                                    Apply
                                      (12,
                                        Variable
                                          (12,
                                            f),
                                        [
                                          Variable
                                            (12,
                                              x)
                                        ]),
                                    Variable
                                      (?,
                                        x_1)))))
                    ]))
            ]))
    ])

9
Value
  (non_rec, @.,
    [
      ((f_map2, [ A; B ], [ (f, (A -> B)); (l, Type (list, A)) ],
        Monad ([ Type (Counter); Type (NonTermination) ], Type (list, B))),
        Bind
          (?,
            Lift
              (?, [ Type (Counter) ],
                [ Type (Counter); Type (NonTermination) ],
                Apply (?, Variable (?, read_counter), [ Tuple (?) ])),
            Some x,
            Lift
              (?, [ Type (NonTermination) ],
                [ Type (Counter); Type (NonTermination) ],
                Apply
                  (?, Variable (?, f_map2_rec),
                    [
                      Variable (?, x);
                      Variable (?, f);
                      Variable (?, l)
                    ]))))
    ])

15
Value
  (non_rec, @.,
    [
      ((n, [ ], [ ], Type (Z)),
        LetFun 16
          (rec, @coq_rec,
            [
              ((sum_coq_rec, [ ], [ (l, Type (list, Type (Z))) ],
                Type (Z)),
                Match
                  (17, Variable (17, l),
                    [
                      (Constructor
                        ([]),
                        Constant
                          (18,
                            Int(0)));
                      (Constructor
                        (cons,
                          x,
                          l),
                        Apply
                          (19,
                            Variable
                              (19,
                                Z.add),
                            [
                              Variable
                                (19,
                                  x);
                              Apply
                                (19,
                                  Variable
                                    (19,
                                      sum_coq_rec),
                                  [
                                    Variable
                                      (19,
                                        l)
                                  ])
                            ]))
                    ]))
            ]) in
        Apply
          (20, Variable (20, sum_coq_rec),
            [
              Constructor
                (20, cons, Constant (20, Int(1)),
                  Constructor
                    (20,
                      cons,
                      Constant
                        (20,
                          Int(2)),
                      Constructor
                        (20,
                          cons,
                          Constant
                            (20,
                              Int(3)),
                          Constructor
                            (20,
                              []))))
            ]))
    ])

22
Value
  (non_rec, @.,
    [
      ((n2, [ A ], [ (x, A) ],
        Monad ([ Type (Counter); Type (NonTermination) ], Type (Z))),
        Match
          (22, Variable (?, x),
            [
              (Any,
                LetFun 23
                  (rec, @.,
                    [
                      ((sum_rec,
                        [
                        ],
                        [
                          (counter,
                            Type
                              (nat));
                          (l,
                            Type
                              (list,
                                Type
                                  (Z)))
                        ],
                        Monad
                          ([
                            Type
                              (NonTermination)
                          ],
                            Type
                              (Z))),
                        Match
                          (?,
                            Variable
                              (?,
                                counter),
                            [
                              (Constructor
                                (O),
                                Apply
                                  (?,
                                    Variable
                                      (?,
                                        not_terminated),
                                    [
                                      Tuple
                                        (?)
                                    ]));
                              (Constructor
                                (S,
                                  counter),
                                Match
                                  (24,
                                    Variable
                                      (24,
                                        l),
                                    [
                                      (Constructor
                                        ([]),
                                        Return
                                          (?,
                                            Constant
                                              (25,
                                                Int(0))));
                                      (Constructor
                                        (cons,
                                          x,
                                          l),
                                        Bind
                                          (?,
                                            Apply
                                              (26,
                                                Apply
                                                  (?,
                                                    Variable
                                                      (?,
                                                        sum_rec),
                                                    [
                                                      Variable
                                                        (?,
                                                          counter)
                                                    ]),
                                                [
                                                  Variable
                                                    (26,
                                                      l)
                                                ]),
                                            Some
                                              x_1,
                                            Return
                                              (?,
                                                Apply
                                                  (26,
                                                    Variable
                                                      (26,
                                                        Z.add),
                                                    [
                                                      Variable
                                                        (26,
                                                          x);
                                                      Variable
                                                        (?,
                                                          x_1)
                                                    ]))))
                                    ]))
                            ]))
                    ])
                  in
                LetFun 23
                  (non_rec, @.,
                    [
                      ((sum
                      (=
                      sum_1),
                        [
                        ],
                        [
                          (l,
                            Type
                              (list,
                                Type
                                  (Z)))
                        ],
                        Monad
                          ([
                            Type
                              (Counter);
                            Type
                              (NonTermination)
                          ],
                            Type
                              (Z))),
                        Bind
                          (?,
                            Lift
                              (?,
                                [
                                  Type
                                    (Counter)
                                ],
                                [
                                  Type
                                    (Counter);
                                  Type
                                    (NonTermination)
                                ],
                                Apply
                                  (?,
                                    Variable
                                      (?,
                                        read_counter),
                                    [
                                      Tuple
                                        (?)
                                    ])),
                            Some
                              x_1,
                            Lift
                              (?,
                                [
                                  Type
                                    (NonTermination)
                                ],
                                [
                                  Type
                                    (Counter);
                                  Type
                                    (NonTermination)
                                ],
                                Apply
                                  (?,
                                    Variable
                                      (?,
                                        sum_rec),
                                    [
                                      Variable
                                        (?,
                                          x_1);
                                      Variable
                                        (?,
                                          l)
                                    ]))))
                    ])
                  in
                Apply
                  (27,
                    Variable
                      (27,
                        sum_1),
                    [
                      Constructor
                        (27,
                          cons,
                          Constant
                            (27,
                              Int(1)),
                          Constructor
                            (27,
                              cons,
                              Constant
                                (27,
                                  Int(2)),
                              Constructor
                                (27,
                                  cons,
                                  Constant
                                    (27,
                                      Int(3)),
                                  Constructor
                                    (27,
                                      []))))
                    ]))
            ]))
    ])
